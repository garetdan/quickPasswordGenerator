<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #1e293b 0%, #581c87 50%, #1e293b 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            padding: 40px;
            width: 100%;
            max-width: 500px;
        }

        .profile-section {
            margin-bottom: 24px;
            padding: 16px;
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .profile-title {
            color: #0c4a6e;
            font-size: 14px;
            font-weight: 600;
        }

        .manage-btn {
            background: #0284c7;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .manage-btn:hover {
            background: #0369a1;
        }

        .profile-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #bae6fd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 24px;
            width: 90%;
            max-width: 450px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #1f2937;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #6b7280;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #1f2937;
        }

        .profile-list {
            margin: 16px 0;
        }

        .profile-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 8px;
            background: #f9fafb;
        }

        .profile-item.active {
            background: #dbeafe;
            border-color: #3b82f6;
        }

        .profile-name {
            font-weight: 500;
            color: #1f2937;
        }

        .profile-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 4px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        .btn-edit {
            background: #6b7280;
            color: white;
        }

        .btn-edit:hover {
            background: #4b5563;
        }

        .new-profile-form {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
        }

        .input-group {
            margin-bottom: 12px;
        }

        .input-group label {
            display: block;
            font-size: 13px;
            color: #374151;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .btn-primary {
            background: #9333ea;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            background: #7e22ce;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 8px;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .password-input-wrapper {
            position: relative;
        }

        .toggle-password-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            color: #6b7280;
        }

        .toggle-password-btn:hover {
            color: #1f2937;
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
        }

        h1 {
            color: #1f2937;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #6b7280;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            color: #374151;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: all 0.2s;
        }

        input[type="text"]:focus {
            border-color: #9333ea;
            ring: 2px solid #9333ea;
            box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.1);
        }

        .generate-btn {
            width: 100%;
            background: linear-gradient(135deg, #9333ea 0%, #4f46e5 100%);
            color: white;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 10px 15px -3px rgba(147, 51, 234, 0.3);
        }

        .generate-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #7e22ce 0%, #4338ca 100%);
            box-shadow: 0 20px 25px -5px rgba(147, 51, 234, 0.4);
            transform: translateY(-1px);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .password-output {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            margin-top: 24px;
            display: none;
        }

        .password-output.visible {
            display: block;
        }

        .password-label {
            display: block;
            color: #374151;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .password-controls {
            display: flex;
            gap: 8px;
        }

        .password-display {
            flex: 1;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 12px 16px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            word-break: break-all;
        }

        .icon-btn {
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover {
            background: #f9fafb;
        }

        .icon-btn.copy {
            background: #9333ea;
            border-color: #9333ea;
            color: white;
        }

        .icon-btn.copy:hover {
            background: #7e22ce;
        }

        .icon-btn.copied {
            background: #059669;
            border-color: #059669;
        }

        .warning-box {
            background: #fffbeb;
            border: 1px solid #fcd34d;
            border-radius: 8px;
            padding: 16px;
            margin-top: 24px;
        }

        .warning-text {
            color: #92400e;
            font-size: 12px;
            line-height: 1.5;
        }

        .warning-text strong {
            font-weight: 600;
        }

        /* Password Options */
        .password-options {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .options-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
        }

        .mode-selector {
            margin-bottom: 16px;
        }

        .mode-selector label {
            display: block;
            font-size: 13px;
            color: #374151;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .mode-selector select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-wrapper input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-wrapper label {
            font-size: 14px;
            color: #374151;
            cursor: pointer;
            margin: 0;
        }

        .length-control {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .length-control label {
            font-size: 14px;
            color: #374151;
            margin: 0;
        }

        .length-control input[type="number"] {
            width: 80px;
            padding: 6px 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .passphrase-options {
            display: none;
        }

        .passphrase-options.active {
            display: block;
        }

        .password-options-content {
            display: block;
        }

        .password-options-content.hidden {
            display: none;
        }

        .slider-control {
            margin-top: 8px;
        }

        .slider-control label {
            display: block;
            font-size: 14px;
            color: #374151;
            margin-bottom: 8px;
        }

        .slider-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .slider-wrapper input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #d1d5db;
            outline: none;
            -webkit-appearance: none;
        }

        .slider-wrapper input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #9333ea;
            cursor: pointer;
        }

        .slider-wrapper input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #9333ea;
            cursor: pointer;
            border: none;
        }

        .slider-value {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            min-width: 60px;
            text-align: right;
        }

        /* SVG Icons */
        .icon {
            width: 20px;
            height: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Password Generator</h1>
            <p class="subtitle">Generate a unique, deterministic password or passphrase</p>
        </div>

        <div class="profile-section">
            <div class="profile-header">
                <span class="profile-title">Profile Select</span>
                <button class="manage-btn" id="manageProfilesBtn">Manage Profiles</button>
            </div>
            <select class="profile-select" id="profileSelect">
                <option value="">No Profile Selected</option>
            </select>
        </div>

        <div class="form-group">
            <label for="keyInput">Key (e.g., website name)</label>
            <input 
                type="text" 
                id="keyInput" 
                placeholder="example.com"
                autocomplete="off"
            >
        </div>

        <div class="password-options">
            <div class="options-title">Generation Options</div>
            
            <div class="mode-selector">
                <label for="generationMode">Mode</label>
                <select id="generationMode">
                    <option value="password">Password</option>
                    <option value="passphrase">Passphrase</option>
                </select>
            </div>

            <div class="password-options-content" id="passwordOptions">
                <div class="options-grid">
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="includeUppercase" checked>
                        <label for="includeUppercase">Uppercase (A-Z)</label>
                    </div>
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="includeNumbers" checked>
                        <label for="includeNumbers">Numbers (0-9)</label>
                    </div>
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="includeSymbols" checked>
                        <label for="includeSymbols">Symbols (!@#$)</label>
                    </div>
                </div>
                <div class="length-control">
                    <label for="passwordLength">Length:</label>
                    <input type="number" id="passwordLength" min="4" max="64" value="16">
                </div>
            </div>

            <div class="passphrase-options" id="passphraseOptions">
                <div class="slider-control">
                    <label for="wordCount">Number of Words</label>
                    <div class="slider-wrapper">
                        <input type="range" id="wordCount" min="3" max="8" value="4" step="1">
                        <span class="slider-value" id="wordCountValue">4 words</span>
                    </div>
                </div>
            </div>
        </div>

        <button class="generate-btn" id="generateBtn">
            Generate Password
        </button>

        <div class="password-output" id="passwordOutput">
            <span class="password-label">Your Password</span>
            <div class="password-controls">
                <div class="password-display" id="passwordDisplay">••••••••••••••••</div>
                <button class="icon-btn" id="toggleBtn" title="Toggle visibility">
                    <svg class="icon" id="eyeIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    <svg class="icon" id="eyeOffIcon" style="display: none;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
                    </svg>
                </button>
                <button class="icon-btn copy" id="copyBtn" title="Copy password">
                    <svg class="icon" id="copyIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    <svg class="icon" id="checkIcon" style="display: none;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div class="warning-box">
            <p class="warning-text">
                <strong>Note:</strong> The same key will always generate the same password. 
                Keep your keys consistent (e.g., always use "gmail.com" not "Gmail" or "gmail").
                Your master secret ensures your passwords are unique to you.
            </p>
        </div>
    </div>

    <!-- Profile Management Modal -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Manage Profiles</h2>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>

            <div class="profile-list" id="profileList">
                <!-- Profiles will be inserted here -->
            </div>

            <div class="new-profile-form">
                <h3 style="font-size: 16px; margin-bottom: 12px; color: #1f2937;">Create New Profile</h3>
                <div class="input-group">
                    <label for="newProfileName">Profile Name</label>
                    <input type="text" id="newProfileName" placeholder="e.g., Work, Personal">
                </div>
                <div class="input-group">
                    <label for="newProfileSecret">Master Secret</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="newProfileSecret" placeholder="Your unique master secret">
                        <button class="toggle-password-btn" id="toggleNewSecret" type="button">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div style="margin-top: 12px;">
                    <button class="btn-primary" id="saveProfileBtn">Save Profile</button>
                    <button class="btn-secondary" id="cancelNewProfileBtn">Cancel</button>
                </div>
            </div>

            <!-- Edit Profile Form (hidden by default) -->
            <div class="new-profile-form" id="editProfileForm" style="display: none;">
                <h3 style="font-size: 16px; margin-bottom: 12px; color: #1f2937;">Edit Profile</h3>
                <div class="input-group">
                    <label for="editProfileName">Profile Name</label>
                    <input type="text" id="editProfileName">
                </div>
                <div class="input-group">
                    <label for="editProfileSecret">Master Secret</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="editProfileSecret">
                        <button class="toggle-password-btn" id="toggleEditSecret" type="button">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div style="margin-top: 12px;">
                    <button class="btn-primary" id="updateProfileBtn">Update Profile</button>
                    <button class="btn-secondary" id="cancelEditBtn">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let generatedPassword = '';
        let showPassword = false;
        let profiles = [];
        let currentProfileId = null;
        let currentMasterSecret = ''; // Store master secret internally
        let editingProfileId = null;

        // DOM elements
        const keyInput = document.getElementById('keyInput');
        const generateBtn = document.getElementById('generateBtn');
        const passwordOutput = document.getElementById('passwordOutput');
        const passwordDisplay = document.getElementById('passwordDisplay');
        const toggleBtn = document.getElementById('toggleBtn');
        const copyBtn = document.getElementById('copyBtn');
        const eyeIcon = document.getElementById('eyeIcon');
        const eyeOffIcon = document.getElementById('eyeOffIcon');
        const copyIcon = document.getElementById('copyIcon');
        const checkIcon = document.getElementById('checkIcon');
        const profileSelect = document.getElementById('profileSelect');
        const manageProfilesBtn = document.getElementById('manageProfilesBtn');
        const profileModal = document.getElementById('profileModal');
        const closeModal = document.getElementById('closeModal');
        const profileList = document.getElementById('profileList');
        const newProfileName = document.getElementById('newProfileName');
        const newProfileSecret = document.getElementById('newProfileSecret');
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        const cancelNewProfileBtn = document.getElementById('cancelNewProfileBtn');
        const editProfileForm = document.getElementById('editProfileForm');
        const editProfileName = document.getElementById('editProfileName');
        const editProfileSecret = document.getElementById('editProfileSecret');
        const updateProfileBtn = document.getElementById('updateProfileBtn');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const toggleNewSecret = document.getElementById('toggleNewSecret');
        const toggleEditSecret = document.getElementById('toggleEditSecret');
        const includeUppercase = document.getElementById('includeUppercase');
        const includeNumbers = document.getElementById('includeNumbers');
        const includeSymbols = document.getElementById('includeSymbols');
        const passwordLength = document.getElementById('passwordLength');
        const generationMode = document.getElementById('generationMode');
        const passwordOptionsContent = document.getElementById('passwordOptions');
        const passphraseOptionsContent = document.getElementById('passphraseOptions');
        const wordCount = document.getElementById('wordCount');
        const wordCountValue = document.getElementById('wordCountValue');

        // Load profiles from localStorage
        function loadProfiles() {
            const saved = localStorage.getItem('passwordProfiles');
            if (saved) {
                profiles = JSON.parse(saved);
            }
            const savedCurrentId = localStorage.getItem('currentProfileId');
            if (savedCurrentId) {
                currentProfileId = savedCurrentId;
            }
            updateProfileSelect();
            loadCurrentProfile();
        }

        // Save profiles to localStorage
        function saveProfiles() {
            localStorage.setItem('passwordProfiles', JSON.stringify(profiles));
            if (currentProfileId) {
                localStorage.setItem('currentProfileId', currentProfileId);
            }
        }

        // Update profile dropdown
        function updateProfileSelect() {
            profileSelect.innerHTML = '<option value="">No Profile Selected</option>';
            profiles.forEach(profile => {
                const option = document.createElement('option');
                option.value = profile.id;
                option.textContent = profile.name;
                if (profile.id === currentProfileId) {
                    option.selected = true;
                }
                profileSelect.appendChild(option);
            });
        }

        // Load current profile's master secret
        function loadCurrentProfile() {
            if (currentProfileId) {
                const profile = profiles.find(p => p.id === currentProfileId);
                if (profile) {
                    currentMasterSecret = profile.secret;
                } else {
                    currentMasterSecret = '';
                }
            } else {
                currentMasterSecret = '';
            }
        }

        // Render profile list in modal
        function renderProfileList() {
            profileList.innerHTML = '';
            
            if (profiles.length === 0) {
                profileList.innerHTML = '<p style="color: #6b7280; text-align: center; padding: 20px;">No profiles yet. Create one below!</p>';
                return;
            }

            profiles.forEach(profile => {
                const item = document.createElement('div');
                item.className = 'profile-item' + (profile.id === currentProfileId ? ' active' : '');
                item.innerHTML = `
                    <span class="profile-name">${escapeHtml(profile.name)}</span>
                    <div class="profile-actions">
                        <button class="btn-small btn-edit" data-id="${profile.id}">Edit</button>
                        <button class="btn-small btn-delete" data-id="${profile.id}">Delete</button>
                    </div>
                `;
                profileList.appendChild(item);
            });

            // Add event listeners for edit and delete
            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.getAttribute('data-id');
                    startEditProfile(id);
                });
            });

            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.getAttribute('data-id');
                    deleteProfile(id);
                });
            });
        }

        // Create new profile
        function createProfile() {
            const name = newProfileName.value.trim();
            const secret = newProfileSecret.value;

            if (!name || !secret) {
                alert('Please enter both profile name and master secret');
                return;
            }

            const profile = {
                id: Date.now().toString(),
                name: name,
                secret: secret
            };

            profiles.push(profile);
            currentProfileId = profile.id;
            currentMasterSecret = secret;
            saveProfiles();
            updateProfileSelect();
            renderProfileList();

            // Clear form
            newProfileName.value = '';
            newProfileSecret.value = '';
            newProfileSecret.type = 'password';
        }

        // Start editing profile
        function startEditProfile(id) {
            const profile = profiles.find(p => p.id === id);
            if (!profile) return;

            editingProfileId = id;
            editProfileName.value = profile.name;
            editProfileSecret.value = profile.secret;
            editProfileSecret.type = 'password';

            // Hide new profile form, show edit form
            document.querySelector('.new-profile-form').style.display = 'none';
            editProfileForm.style.display = 'block';
        }

        // Update profile
        function updateProfile() {
            const name = editProfileName.value.trim();
            const secret = editProfileSecret.value;

            if (!name || !secret) {
                alert('Please enter both profile name and master secret');
                return;
            }

            const profileIndex = profiles.findIndex(p => p.id === editingProfileId);
            if (profileIndex !== -1) {
                profiles[profileIndex].name = name;
                profiles[profileIndex].secret = secret;
                saveProfiles();
                updateProfileSelect();
                if (currentProfileId === editingProfileId) {
                    currentMasterSecret = secret;
                }
                renderProfileList();
            }

            cancelEdit();
        }

        // Cancel edit
        function cancelEdit() {
            editProfileForm.style.display = 'none';
            document.querySelector('.new-profile-form').style.display = 'block';
            editingProfileId = null;
            editProfileName.value = '';
            editProfileSecret.value = '';
            editProfileSecret.type = 'password';
        }

        // Delete profile
        function deleteProfile(id) {
            if (!confirm('Are you sure you want to delete this profile?')) {
                return;
            }

            profiles = profiles.filter(p => p.id !== id);
            if (currentProfileId === id) {
                currentProfileId = null;
                currentMasterSecret = '';
            }
            saveProfiles();
            updateProfileSelect();
            renderProfileList();
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Word list for passphrase generation (EFF long wordlist style)
        const wordList = [
            'able', 'about', 'account', 'acid', 'across', 'action', 'addition', 'adjust', 'after', 'again',
            'against', 'agree', 'airplane', 'alarm', 'album', 'almost', 'alone', 'along', 'already', 'also',
            'amazing', 'amount', 'anchor', 'angle', 'angry', 'animal', 'answer', 'apple', 'approach', 'april',
            'area', 'argue', 'around', 'arrive', 'artist', 'asleep', 'attack', 'august', 'autumn', 'average',
            'avoid', 'awake', 'aware', 'balance', 'balloon', 'banana', 'basic', 'basket', 'battle', 'beach',
            'beauty', 'become', 'before', 'begin', 'behave', 'behind', 'believe', 'benefit', 'berry', 'between',
            'beyond', 'bicycle', 'birthday', 'black', 'blanket', 'block', 'blood', 'board', 'border', 'bottle',
            'bottom', 'branch', 'brave', 'bread', 'break', 'bridge', 'bright', 'bring', 'brother', 'brown',
            'brush', 'budget', 'build', 'bundle', 'button', 'cabin', 'cable', 'cactus', 'camera', 'cancel',
            'candle', 'canvas', 'capable', 'capital', 'capture', 'carbon', 'carpet', 'carry', 'castle', 'catch',
            'category', 'cause', 'ceiling', 'center', 'century', 'certain', 'chair', 'change', 'chapter', 'charge',
            'chase', 'cheap', 'cheese', 'cherry', 'chicken', 'choice', 'circle', 'citizen', 'clarify', 'classic',
            'clever', 'client', 'climate', 'climb', 'clock', 'close', 'cloud', 'cluster', 'coach', 'coast',
            'coffee', 'collect', 'color', 'column', 'combine', 'comfort', 'command', 'common', 'company', 'compare',
            'compete', 'complex', 'concept', 'concern', 'conduct', 'confirm', 'connect', 'consider', 'contact', 'contain',
            'content', 'contest', 'context', 'control', 'convert', 'copper', 'corner', 'correct', 'cotton', 'counter',
            'country', 'couple', 'courage', 'course', 'cousin', 'cover', 'cradle', 'crash', 'crater', 'create',
            'credit', 'cricket', 'crisis', 'critic', 'cross', 'crowd', 'crucial', 'cruise', 'crystal', 'culture',
            'curious', 'current', 'curtain', 'curve', 'custom', 'cycle', 'damage', 'dance', 'danger', 'daughter',
            'debate', 'decade', 'december', 'decide', 'decline', 'decrease', 'define', 'degree', 'delay', 'deliver',
            'demand', 'deposit', 'derive', 'describe', 'desert', 'design', 'desktop', 'detail', 'detect', 'develop',
            'device', 'diamond', 'diary', 'differ', 'digital', 'dinner', 'direct', 'display', 'distance', 'divide',
            'doctor', 'document', 'domestic', 'donate', 'double', 'draft', 'dragon', 'drama', 'drawer', 'dream',
            'dress', 'drift', 'drink', 'drive', 'driver', 'during', 'dynamic', 'eagle', 'early', 'earth',
            'easily', 'eastern', 'echo', 'ecology', 'economy', 'edge', 'edit', 'educate', 'effect', 'effort',
            'eight', 'either', 'elbow', 'elder', 'electric', 'element', 'elephant', 'eleven', 'emerge', 'emotion',
            'employ', 'enable', 'encourage', 'energy', 'enforce', 'engage', 'engine', 'enhance', 'enjoy', 'enough',
            'ensure', 'enter', 'entire', 'entry', 'envelope', 'episode', 'equal', 'equip', 'error', 'escape',
            'estate', 'estimate', 'evening', 'event', 'every', 'evidence', 'evolve', 'exact', 'example', 'except',
            'exchange', 'execute', 'exercise', 'exhibit', 'exist', 'exotic', 'expand', 'expect', 'explain', 'explore',
            'export', 'expose', 'express', 'extend', 'extra', 'fabric', 'factor', 'faculty', 'failure', 'family',
            'famous', 'fantasy', 'fashion', 'father', 'fault', 'feature', 'february', 'federal', 'feeling', 'female',
            'fence', 'festival', 'fiber', 'fiction', 'field', 'fifteen', 'figure', 'final', 'finance', 'finger',
            'finish', 'first', 'fiscal', 'flavor', 'flight', 'float', 'floor', 'flower', 'focus', 'follow',
            'force', 'forest', 'forever', 'forget', 'formal', 'former', 'formula', 'fortune', 'forward', 'foster',
            'found', 'fourth', 'frame', 'frequent', 'fresh', 'friday', 'friend', 'fringe', 'front', 'frozen',
            'fruit', 'function', 'future', 'galaxy', 'gallery', 'game', 'garden', 'gather', 'general', 'genius',
            'gentle', 'gesture', 'ghost', 'giant', 'gift', 'ginger', 'giraffe', 'glass', 'global', 'glove',
            'goddess', 'golden', 'govern', 'grace', 'grain', 'grand', 'grant', 'grape', 'grass', 'great',
            'green', 'grid', 'ground', 'group', 'growth', 'guard', 'guess', 'guest', 'guide', 'guitar',
            'habit', 'hammer', 'handle', 'happy', 'harbor', 'hardly', 'harvest', 'health', 'heart', 'heavy',
            'height', 'hello', 'helmet', 'help', 'hidden', 'high', 'history', 'hobby', 'hold', 'holiday',
            'home', 'honest', 'honor', 'hope', 'horizon', 'horse', 'hospital', 'hotel', 'house', 'human',
            'humble', 'hundred', 'hungry', 'hurdle', 'hybrid', 'ice', 'idea', 'identify', 'ignore', 'image',
            'impact', 'import', 'improve', 'include', 'income', 'increase', 'index', 'indicate', 'indoor', 'industry',
            'infant', 'inform', 'initial', 'injury', 'input', 'inquiry', 'insect', 'inside', 'inspire', 'install',
            'instance', 'instant', 'instead', 'interest', 'interior', 'invest', 'invite', 'involve', 'island', 'issue',
            'item', 'jacket', 'january', 'jealous', 'jeans', 'join', 'joint', 'journey', 'judge', 'juice',
            'july', 'jump', 'june', 'jungle', 'junior', 'justice', 'kangaroo', 'keen', 'keep', 'kernel',
            'kind', 'kingdom', 'kitchen', 'kitten', 'knife', 'knock', 'know', 'label', 'labor', 'ladder',
            'lady', 'lake', 'lamp', 'language', 'laptop', 'large', 'laser', 'later', 'latin', 'laugh',
            'laundry', 'launch', 'layer', 'lazy', 'leader', 'learn', 'lease', 'leave', 'lecture', 'left',
            'legal', 'legend', 'lemon', 'length', 'lesson', 'letter', 'level', 'liberty', 'library', 'license',
            'light', 'likely', 'limit', 'liquid', 'list', 'little', 'local', 'logic', 'lonely', 'long',
            'lottery', 'lounge', 'love', 'loyal', 'lucky', 'lunar', 'lunch', 'luxury', 'machine', 'magic',
            'magnet', 'major', 'make', 'mammal', 'manage', 'mandate', 'mango', 'manner', 'manual', 'maple',
            'marble', 'march', 'margin', 'marine', 'market', 'marriage', 'mask', 'master', 'match', 'material',
            'matter', 'maximum', 'maybe', 'meadow', 'measure', 'mechanic', 'media', 'medical', 'medium', 'melody',
            'member', 'memory', 'mention', 'menu', 'mercy', 'merge', 'merit', 'message', 'metal', 'method',
            'middle', 'midnight', 'milk', 'million', 'mimic', 'mind', 'minimum', 'minor', 'minute', 'mirror',
            'miss', 'mistake', 'mixed', 'mobile', 'model', 'modern', 'modify', 'moment', 'monday', 'money',
            'monitor', 'monkey', 'monster', 'month', 'moral', 'morning', 'motion', 'motor', 'mountain', 'mouse',
            'move', 'movie', 'much', 'muffin', 'multiple', 'muscle', 'museum', 'music', 'mutual', 'myself',
            'mystery', 'narrow', 'nation', 'nature', 'near', 'neck', 'negative', 'neglect', 'neither', 'nephew',
            'nerve', 'never', 'news', 'next', 'nice', 'night', 'nine', 'noble', 'noise', 'nominee',
            'noodle', 'normal', 'north', 'nose', 'notable', 'note', 'nothing', 'notice', 'novel', 'november',
            'nuclear', 'number', 'nurse', 'object', 'observe', 'obtain', 'obvious', 'occur', 'ocean', 'october',
            'odor', 'offer', 'office', 'often', 'okay', 'olive', 'olympic', 'omega', 'once', 'online',
            'only', 'open', 'opera', 'opinion', 'oppose', 'option', 'orange', 'orbit', 'order', 'ordinary',
            'organ', 'organize', 'orient', 'original', 'other', 'outdoor', 'outer', 'output', 'outside', 'oval',
            'over', 'owner', 'oxygen', 'oyster', 'ozone', 'package', 'paddle', 'page', 'paint', 'palace',
            'panel', 'paper', 'parade', 'parent', 'park', 'parrot', 'party', 'pass', 'paste', 'path',
            'patient', 'patrol', 'pattern', 'pause', 'payment', 'peace', 'peanut', 'peasant', 'pelican', 'penalty',
            'pencil', 'people', 'pepper', 'perfect', 'perform', 'period', 'permit', 'person', 'photo', 'phrase',
            'physical', 'piano', 'picnic', 'picture', 'piece', 'pilot', 'pink', 'pioneer', 'pipe', 'pistol',
            'pitch', 'pizza', 'place', 'planet', 'plastic', 'plate', 'play', 'please', 'pledge', 'pluck',
            'plunge', 'poem', 'poet', 'point', 'polar', 'police', 'policy', 'pool', 'popular', 'portion',
            'position', 'possible', 'post', 'potato', 'pottery', 'poverty', 'powder', 'power', 'practice', 'praise',
            'predict', 'prefer', 'prepare', 'present', 'pretty', 'prevent', 'previous', 'price', 'pride', 'primary',
            'print', 'priority', 'prison', 'private', 'prize', 'problem', 'process', 'produce', 'profit', 'program',
            'project', 'promote', 'proof', 'property', 'prosper', 'protect', 'proud', 'provide', 'public', 'pudding',
            'pull', 'pulse', 'pumpkin', 'punch', 'pupil', 'puppy', 'purchase', 'purity', 'purpose', 'purse',
            'push', 'puzzle', 'pyramid', 'quality', 'quantum', 'quarter', 'question', 'quick', 'quiet', 'quit',
            'quiz', 'quote', 'rabbit', 'raccoon', 'race', 'rack', 'radar', 'radio', 'rail', 'rain',
            'raise', 'rally', 'ramp', 'ranch', 'random', 'range', 'rapid', 'rare', 'rate', 'rather',
            'raven', 'reach', 'react', 'ready', 'real', 'reason', 'rebel', 'rebuild', 'recall', 'receive',
            'recent', 'recipe', 'record', 'recycle', 'reduce', 'reflect', 'reform', 'refuse', 'region', 'regret',
            'regular', 'reject', 'relax', 'release', 'relief', 'rely', 'remain', 'remember', 'remind', 'remove',
            'render', 'renew', 'rent', 'repair', 'repeat', 'replace', 'report', 'require', 'rescue', 'resemble',
            'resist', 'resource', 'response', 'result', 'retire', 'retreat', 'return', 'reunion', 'reveal', 'review',
            'reward', 'rhythm', 'ribbon', 'rice', 'rich', 'ride', 'ridge', 'rifle', 'right', 'rigid',
            'ring', 'riot', 'ripple', 'risk', 'ritual', 'rival', 'river', 'road', 'roast', 'robot',
            'rock', 'rocket', 'romance', 'roof', 'rookie', 'room', 'rose', 'rotate', 'rough', 'round',
            'route', 'royal', 'rubber', 'rude', 'rug', 'rule', 'run', 'runway', 'rural', 'sad',
            'saddle', 'safe', 'sail', 'salad', 'salmon', 'salon', 'salt', 'sample', 'sand', 'satisfy',
            'saturday', 'sauce', 'sausage', 'save', 'scale', 'scan', 'scare', 'scatter', 'scene', 'scheme',
            'school', 'science', 'scissors', 'scorpion', 'scout', 'scrap', 'screen', 'script', 'scroll', 'search',
            'season', 'seat', 'second', 'secret', 'section', 'secure', 'segment', 'select', 'sell', 'seminar',
            'senior', 'sense', 'sentence', 'september', 'sequence', 'series', 'service', 'session', 'settle', 'setup',
            'seven', 'shadow', 'shaft', 'shallow', 'share', 'shed', 'shell', 'sheriff', 'shield', 'shift',
            'shine', 'ship', 'shock', 'shoe', 'shoot', 'shop', 'short', 'shoulder', 'shove', 'shrimp',
            'shrug', 'shuffle', 'sibling', 'sick', 'side', 'siege', 'sight', 'sign', 'silent', 'silk',
            'silly', 'silver', 'similar', 'simple', 'since', 'sing', 'siren', 'sister', 'situate', 'six',
            'size', 'skate', 'sketch', 'skill', 'skin', 'skirt', 'skull', 'slab', 'slam', 'sleep',
            'slender', 'slice', 'slide', 'slight', 'slim', 'slogan', 'slot', 'slow', 'slush', 'small',
            'smart', 'smile', 'smoke', 'smooth', 'snack', 'snake', 'snap', 'sniff', 'snow', 'social',
            'sock', 'soda', 'soft', 'solar', 'soldier', 'solid', 'solution', 'solve', 'someone', 'song',
            'soon', 'sorry', 'sort', 'soul', 'sound', 'source', 'south', 'space', 'spare', 'spatial',
            'spawn', 'speak', 'special', 'speed', 'spell', 'spend', 'sphere', 'spice', 'spider', 'spike',
            'spin', 'spirit', 'split', 'sponsor', 'spoon', 'sport', 'spot', 'spray', 'spread', 'spring',
            'spy', 'square', 'squeeze', 'squirrel', 'stable', 'stadium', 'staff', 'stage', 'stairs', 'stamp',
            'stand', 'start', 'state', 'stay', 'steak', 'steel', 'stem', 'step', 'stereo', 'stick',
            'still', 'sting', 'stock', 'stomach', 'stone', 'stool', 'story', 'stove', 'strategy', 'street',
            'strike', 'strong', 'struggle', 'student', 'stuff', 'stumble', 'style', 'subject', 'submit', 'subway',
            'success', 'such', 'sudden', 'suffer', 'sugar', 'suggest', 'suit', 'summer', 'sunday', 'sunny',
            'sunset', 'super', 'supply', 'supreme', 'surface', 'surge', 'surprise', 'surround', 'survey', 'suspect',
            'sustain', 'swallow', 'swamp', 'swap', 'swarm', 'sweet', 'swift', 'swim', 'swing', 'switch',
            'sword', 'symbol', 'symptom', 'syrup', 'system', 'table', 'tackle', 'tag', 'tail', 'talent',
            'talk', 'tank', 'tape', 'target', 'task', 'taste', 'tattoo', 'taxi', 'teach', 'team',
            'tell', 'tenant', 'tennis', 'tent', 'term', 'test', 'text', 'thank', 'theater', 'theme',
            'theory', 'there', 'they', 'thing', 'think', 'third', 'thought', 'three', 'thrive', 'throw',
            'thumb', 'thunder', 'ticket', 'tidal', 'tiger', 'tilt', 'timber', 'time', 'tiny', 'tip',
            'tired', 'tissue', 'title', 'toast', 'tobacco', 'today', 'toddler', 'together', 'toilet', 'token',
            'tomato', 'tomorrow', 'tone', 'tongue', 'tonight', 'tool', 'tooth', 'topic', 'topple', 'tornado',
            'tortoise', 'total', 'tourist', 'toward', 'tower', 'town', 'toy', 'track', 'trade', 'traffic',
            'tragic', 'train', 'transfer', 'trap', 'trash', 'travel', 'tray', 'treat', 'tree', 'trend',
            'trial', 'tribe', 'trick', 'trigger', 'trim', 'trip', 'trophy', 'trouble', 'truck', 'true',
            'trumpet', 'trust', 'truth', 'try', 'tube', 'tuition', 'tumble', 'tuna', 'tunnel', 'turkey',
            'turn', 'turtle', 'twelve', 'twenty', 'twice', 'twin', 'twist', 'two', 'type', 'typical',
            'ugly', 'umbrella', 'unable', 'unaware', 'uncle', 'uncover', 'under', 'undo', 'unfair', 'unfold',
            'unhappy', 'uniform', 'unique', 'unit', 'universe', 'unknown', 'unlock', 'until', 'unusual', 'unveil',
            'update', 'upgrade', 'uphold', 'upon', 'upper', 'upset', 'urban', 'urge', 'usage', 'use',
            'used', 'useful', 'useless', 'usual', 'utility', 'vacant', 'vacuum', 'vague', 'valid', 'valley',
            'valve', 'van', 'vanish', 'vapor', 'various', 'vast', 'vault', 'vehicle', 'velvet', 'vendor',
            'venture', 'venue', 'verb', 'verify', 'version', 'very', 'vessel', 'veteran', 'viable', 'vibrant',
            'vicious', 'victory', 'video', 'view', 'village', 'vintage', 'violin', 'virtual', 'virus', 'visa',
            'visit', 'visual', 'vital', 'vivid', 'vocal', 'voice', 'void', 'volcano', 'volume', 'vote',
            'voyage', 'wage', 'wagon', 'wait', 'walk', 'wall', 'walnut', 'want', 'warfare', 'warm',
            'warrior', 'wash', 'wasp', 'waste', 'watch', 'water', 'wave', 'way', 'wealth', 'weapon',
            'wear', 'weasel', 'weather', 'web', 'wedding', 'weekend', 'weird', 'welcome', 'west', 'wet',
            'whale', 'what', 'wheat', 'wheel', 'when', 'where', 'whip', 'whisper', 'wide', 'width',
            'wife', 'wild', 'will', 'win', 'window', 'wine', 'wing', 'wink', 'winner', 'winter',
            'wire', 'wisdom', 'wise', 'wish', 'witness', 'wolf', 'woman', 'wonder', 'wood', 'wool',
            'word', 'work', 'world', 'worry', 'worth', 'wrap', 'wreck', 'wrestle', 'wrist', 'write',
            'wrong', 'yard', 'year', 'yellow', 'you', 'young', 'youth', 'zebra', 'zero', 'zone', 'zoo'
        ];

        // Generate passphrase
        function generatePassphrase(input, secret, numWords) {
            if (!input) return '';
            
            // Combine input with master secret and word count
            const combined = input + (secret || '') + numWords.toString();
            
            // Create a hash from the combined input
            let hash = 0;
            for (let i = 0; i < combined.length; i++) {
                const char = combined.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            
            // Use the hash as a seed for deterministic "random" generation
            const seed = Math.abs(hash);
            
            // Create a deterministic pseudo-random number generator
            const seededRandom = (seed) => {
                let value = seed;
                return () => {
                    value = (value * 9301 + 49297) % 233280;
                    return value / 233280;
                };
            };
            
            const rng = seededRandom(seed);
            
            // Select words
            const words = [];
            for (let i = 0; i < numWords; i++) {
                const index = Math.floor(rng() * wordList.length);
                words.push(wordList[index]);
            }
            
            // Join with hyphens
            return words.join('-');
        }

        // Deterministic password generation with master secret and options
        function generatePassword(input, secret, options) {
            if (!input) return '';
            
            // Combine input with master secret and options to ensure different passwords for different settings
            const optionsString = JSON.stringify(options);
            const combined = input + (secret || '') + optionsString;
            
            // Create a hash from the combined input
            let hash = 0;
            for (let i = 0; i < combined.length; i++) {
                const char = combined.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            
            // Use the hash as a seed for deterministic "random" generation
            const seed = Math.abs(hash);
            
            // Create a deterministic pseudo-random number generator
            const seededRandom = (seed) => {
                let value = seed;
                return () => {
                    value = (value * 9301 + 49297) % 233280;
                    return value / 233280;
                };
            };
            
            const rng = seededRandom(seed);
            
            // Character sets
            const lowercase = 'abcdefghijklmnopqrstuvwxyz';
            const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const numbers = '0123456789';
            const symbols = '!@#$%^&*()_+-=[]{}|;:,.<>?';
            
            // Build available character set based on options
            let availableChars = lowercase; // Always include lowercase
            const requiredChars = [];
            
            if (options.includeUppercase) {
                availableChars += uppercase;
                requiredChars.push(uppercase);
            }
            if (options.includeNumbers) {
                availableChars += numbers;
                requiredChars.push(numbers);
            }
            if (options.includeSymbols) {
                availableChars += symbols;
                requiredChars.push(symbols);
            }
            
            // Ensure at least lowercase is available
            if (availableChars.length === 0) {
                availableChars = lowercase;
            }
            
            // Generate password
            let result = '';
            const length = Math.max(4, Math.min(64, options.length)); // Clamp between 4 and 64
            
            // First, ensure at least one character from each required set
            requiredChars.forEach(charSet => {
                result += charSet[Math.floor(rng() * charSet.length)];
            });
            
            // Fill the rest with random characters from available set
            for (let i = result.length; i < length; i++) {
                result += availableChars[Math.floor(rng() * availableChars.length)];
            }
            
            // Shuffle the result to avoid predictable patterns
            result = result.split('').sort(() => rng() - 0.5).join('');
            
            return result;
        }

        function updateButtonState() {
            generateBtn.disabled = !keyInput.value.trim();
        }

        function handleGenerate() {
            const key = keyInput.value.trim();
            if (!key) return;

            const mode = generationMode.value;

            if (mode === 'passphrase') {
                const numWords = parseInt(wordCount.value) || 4;
                generatedPassword = generatePassphrase(key, currentMasterSecret, numWords);
            } else {
                const options = {
                    includeUppercase: includeUppercase.checked,
                    includeNumbers: includeNumbers.checked,
                    includeSymbols: includeSymbols.checked,
                    length: parseInt(passwordLength.value) || 16
                };
                generatedPassword = generatePassword(key, currentMasterSecret, options);
            }

            showPassword = false;
            updatePasswordDisplay();
            passwordOutput.classList.add('visible');
            
            // Reset copy button
            copyIcon.style.display = 'block';
            checkIcon.style.display = 'none';
            copyBtn.classList.remove('copied');
            copyBtn.classList.add('copy');
        }

        function updatePasswordDisplay() {
            if (showPassword) {
                passwordDisplay.textContent = generatedPassword;
                eyeIcon.style.display = 'none';
                eyeOffIcon.style.display = 'block';
            } else {
                const length = parseInt(passwordLength.value) || 16;
                passwordDisplay.textContent = '•'.repeat(length);
                eyeIcon.style.display = 'block';
                eyeOffIcon.style.display = 'none';
            }
        }

        function togglePasswordVisibility() {
            showPassword = !showPassword;
            updatePasswordDisplay();
        }

        async function copyPassword() {
            if (!generatedPassword) return;

            try {
                await navigator.clipboard.writeText(generatedPassword);
                
                // Show check icon
                copyIcon.style.display = 'none';
                checkIcon.style.display = 'block';
                copyBtn.classList.remove('copy');
                copyBtn.classList.add('copied');
                
                // Reset after 2 seconds
                setTimeout(() => {
                    copyIcon.style.display = 'block';
                    checkIcon.style.display = 'none';
                    copyBtn.classList.remove('copied');
                    copyBtn.classList.add('copy');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy:', err);
            }
        }

        // Toggle password visibility helpers
        function setupPasswordToggle(toggleBtn, inputField) {
            toggleBtn.addEventListener('click', () => {
                const type = inputField.type === 'password' ? 'text' : 'password';
                inputField.type = type;
            });
        }

        // Event listeners
        keyInput.addEventListener('input', updateButtonState);
        keyInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleGenerate();
        });
        generateBtn.addEventListener('click', handleGenerate);
        toggleBtn.addEventListener('click', togglePasswordVisibility);
        copyBtn.addEventListener('click', copyPassword);

        // Profile events
        profileSelect.addEventListener('change', (e) => {
            currentProfileId = e.target.value || null;
            if (currentProfileId) {
                saveProfiles();
                loadCurrentProfile();
            } else {
                currentMasterSecret = '';
            }
        });

        manageProfilesBtn.addEventListener('click', () => {
            renderProfileList();
            profileModal.classList.add('active');
        });

        closeModal.addEventListener('click', () => {
            profileModal.classList.remove('active');
            cancelEdit();
        });

        profileModal.addEventListener('click', (e) => {
            if (e.target === profileModal) {
                profileModal.classList.remove('active');
                cancelEdit();
            }
        });

        saveProfileBtn.addEventListener('click', createProfile);
        cancelNewProfileBtn.addEventListener('click', () => {
            newProfileName.value = '';
            newProfileSecret.value = '';
            newProfileSecret.type = 'password';
        });

        updateProfileBtn.addEventListener('click', updateProfile);
        cancelEditBtn.addEventListener('click', cancelEdit);

        // Setup password toggles
        setupPasswordToggle(toggleNewSecret, newProfileSecret);
        setupPasswordToggle(toggleEditSecret, editProfileSecret);

        // Mode switching
        generationMode.addEventListener('change', () => {
            if (generationMode.value === 'passphrase') {
                passwordOptionsContent.classList.add('hidden');
                passphraseOptionsContent.classList.add('active');
            } else {
                passwordOptionsContent.classList.remove('hidden');
                passphraseOptionsContent.classList.remove('active');
            }
        });

        // Word count slider
        wordCount.addEventListener('input', () => {
            const count = wordCount.value;
            wordCountValue.textContent = `${count} word${count > 1 ? 's' : ''}`;
        });

        // Initialize
        loadProfiles();
        updateButtonState();
    </script>
</body>
</html>
